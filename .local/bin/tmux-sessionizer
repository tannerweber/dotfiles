#!/usr/bin/env fish

if count $argv
	set directory $1
else
	set directory $(find ~/ ~/.dotfiles ~/Personal_Projects ~/CS350_Programs -mindepth 1 -maxdepth 1 -type d | fzf --style full --reverse)
end

if test -z $directory
	echo "The name given is an empty string."
	exit 1
end

set this_user $(whoami)
set selected_name $(basename "$directory" | tr . _)
set tmux_running $(pgrep -u $this_user "tmux")

if test -z $TMUX && test -z $tmux_running
	echo "tmux not running, creating a new session"
	sleep 3
	exec tmux new-session -s $selected_name -c $directory
	exit 0
end

if ! tmux has-session -t=$selected_name 2> /dev/null
	echo "creating inside session"
	sleep 3
	tmux new-session -ds $selected_name -c $directory
end

tmux switch-client -t $selected_name
